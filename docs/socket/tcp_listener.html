<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>inovopy.socket.tcp_listener API documentation</title>
<meta name="description" content="TCP Listener Module
This module provide an api class for listening tcp connection …" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>inovopy.socket.tcp_listener</code></h1>
</header>
<section id="section-intro">
<h1 id="tcp-listener-module">TCP Listener Module</h1>
<p>This module provide an api class for listening tcp connection</p>
<h2 id="classes">Classes</h2>
<ul>
<li><code><a title="inovopy.socket.tcp_listener.TcpListener" href="#inovopy.socket.tcp_listener.TcpListener">TcpListener</a></code> : a class for managing and listening connection</li>
</ul>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
# TCP Listener Module
This module provide an api class for listening tcp connection

## Classes
- `TcpListener` : a class for managing and listening connection
&#34;&#34;&#34;
import socket
import select

from inovopy.socket.utils import SocketException, auto_detect_ips
from inovopy.socket.tcp_stream import TcpStream
from inovopy.logger import Logger

class TcpListener:
    &#34;&#34;&#34;
    # TcpListener
    A class for listening to tcp connection

    ## Usage
    ```python
    from inovopy.socket import TcpListener

    example_listener = TcpListener()

    example_stream = example_listener.accept()
    ```
        
    &#34;&#34;&#34;

    DEFAULT_PORT : int = 50003
    &#34;&#34;&#34;Default port to listen on if no poort are specified `50003`.&#34;&#34;&#34;

    def __init__(
            self,
            host: str | None = None,
            port: int | None = None,
            logger : Logger | None = None,
        ):
        &#34;&#34;&#34;
        initalize the tcp listener

        do not specify the host if you wish to listen at all
        of the host in your machine.

        specify the host if you wish to listen at a specific
        network in you machine

        ## Parameter
        - `host : str | None` : local ip
        - `port : int | None` : port to listen to
        - `logger : Logger | None` : logger for logging

        ## Exception:
        `SocketException`:

        - if not local ip address are found
        - if not vaild socket are created
        &#34;&#34;&#34;
        port : int = port or TcpListener.DEFAULT_PORT

        if logger is None:
            self.logger : Logger = Logger.default(f&#34;TcpListener-{port}&#34;)
            &#34;&#34;&#34;logger for logging&#34;&#34;&#34;
        else:
            self.logger : Logger = logger


        self.logger.debug(&#34;creating TcpListener . . .&#34;)

        if host is None:
            ips = auto_detect_ips(self.logger)
            &#34;&#34;&#34;a list of ip to bind socket to and listen to&#34;&#34;&#34;
        else:
            ips = [host]


        self.logger.info(&#34;Creating Socket . . .&#34;)

        self.__sockets : list[socket.socket] = []
        &#34;&#34;&#34;a list of socket to listen to&#34;&#34;&#34;

        for ip in ips:
            self.logger.debug(f&#34;ip : {ip}&#34;)
            soc : socket.socket= socket.socket(socket.AF_INET, socket.SOCK_STREAM)

            self.logger.debug(&#34;....setting socket option&#34;)
            soc.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)

            self.logger.debug(&#34;....trying to bind . . .&#34;)
            try:
                soc.bind((ip,port))
                self.logger.debug(&#34;....socket binding successful.&#34;)
            except OSError as e:
                self.logger.warn(f&#34;Failed to bind @ {ip}:{port}&#34;)
                self.logger.warn(f&#34;Error: {e}&#34;)
                continue

            self.logger.debug(&#34;....trying to listen . . .&#34;)
            try:
                soc.listen()
                self.logger.debug(&#34;....socket start listening . . .&#34;)
            except OSError as e:
                self.logger.warn(f&#34;Failed to listen @ {ip}:{port}&#34;)
                self.logger.warn(f&#34;{e}&#34;)
                continue

            soc.setblocking(False)

            self.logger.info(f&#34;Finished setting up socket @ {ip}:{port}&#34;)
            self.__sockets.append(soc)


        if len(self.__sockets) == 0:
            self.logger.error(&#34;No vaild socket created.&#34;)
            raise SocketException(&#34;No vaild socket created.&#34;)

    def accept(self, stream_logger : Logger | None = None) -&gt; TcpStream:
        &#34;&#34;&#34;
        try accept a new tcp connection.

        ## Parameter:
        `stream_logger : Logger` : logger of returned TcpStream
        
        ## Return:
        `TcpStream` : the accepted tcp connetion

        ## Exception:
        No exception, will continue to try to accept if encounter `OSError`
        &#34;&#34;&#34;
        self.logger.info(&#34;Start accepting . . .&#34;)

        self.logger.debug(&#34;waiting for connection . . .&#34;)
        while True:
            readables, _, _ = select.select(self.__sockets,[],[],1)

            for soc in readables:
                if soc not in self.__sockets:
                    self.logger.debug(&#34;....readables not in self.__sockets&#34;)
                    continue

                (ip,port) = soc.getsockname()

                self.logger.info(f&#34;trying to accept connection at {ip}:{port}&#34;)

                try:
                    accept = soc.accept()
                    conn : socket.socket = accept[0]
                    peer_ip, peer_port = accept[1]
                    self.logger.info(f&#34;Accepting connect successful to {peer_ip}:{peer_port}&#34;)
                except OSError as e:
                    self.logger.warn(&#34;Accepting connection failed&#34;)
                    self.logger.warn(f&#34;{e}&#34;)
                    continue

                stream = TcpStream(conn, stream_logger)
                return stream


    def __del__(self):
        for soc in self.__sockets:
            try:
                (ip,port) = soc.getsockname()
                self.logger.debug(f&#34;shutting down socket @ {ip}:{port}&#34;)
                soc.close()
            except OSError as e:
                self.logger.error(&#34;Failed to shut down socket!&#34;)
                self.logger.error(f&#34;{e}&#34;)
                continue</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="inovopy.socket.tcp_listener.TcpListener"><code class="flex name class">
<span>class <span class="ident">TcpListener</span></span>
<span>(</span><span>host: Optional[str] = None, port: int | None = None, logger: <a title="inovopy.logger.Logger" href="../logger/index.html#inovopy.logger.Logger">Logger</a> | None = None)</span>
</code></dt>
<dd>
<div class="desc"><h1 id="tcplistener">TcpListener</h1>
<p>A class for listening to tcp connection</p>
<h2 id="usage">Usage</h2>
<pre><code class="language-python">from inovopy.socket import TcpListener

example_listener = TcpListener()

example_stream = example_listener.accept()
</code></pre>
<p>initalize the tcp listener</p>
<p>do not specify the host if you wish to listen at all
of the host in your machine.</p>
<p>specify the host if you wish to listen at a specific
network in you machine</p>
<h2 id="parameter">Parameter</h2>
<ul>
<li><code>host : str | None</code> : local ip</li>
<li><code>port : int | None</code> : port to listen to</li>
<li><code>logger : Logger | None</code> : logger for logging</li>
</ul>
<h2 id="exception">Exception:</h2>
<p><code>SocketException</code>:</p>
<ul>
<li>if not local ip address are found</li>
<li>if not vaild socket are created</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class TcpListener:
    &#34;&#34;&#34;
    # TcpListener
    A class for listening to tcp connection

    ## Usage
    ```python
    from inovopy.socket import TcpListener

    example_listener = TcpListener()

    example_stream = example_listener.accept()
    ```
        
    &#34;&#34;&#34;

    DEFAULT_PORT : int = 50003
    &#34;&#34;&#34;Default port to listen on if no poort are specified `50003`.&#34;&#34;&#34;

    def __init__(
            self,
            host: str | None = None,
            port: int | None = None,
            logger : Logger | None = None,
        ):
        &#34;&#34;&#34;
        initalize the tcp listener

        do not specify the host if you wish to listen at all
        of the host in your machine.

        specify the host if you wish to listen at a specific
        network in you machine

        ## Parameter
        - `host : str | None` : local ip
        - `port : int | None` : port to listen to
        - `logger : Logger | None` : logger for logging

        ## Exception:
        `SocketException`:

        - if not local ip address are found
        - if not vaild socket are created
        &#34;&#34;&#34;
        port : int = port or TcpListener.DEFAULT_PORT

        if logger is None:
            self.logger : Logger = Logger.default(f&#34;TcpListener-{port}&#34;)
            &#34;&#34;&#34;logger for logging&#34;&#34;&#34;
        else:
            self.logger : Logger = logger


        self.logger.debug(&#34;creating TcpListener . . .&#34;)

        if host is None:
            ips = auto_detect_ips(self.logger)
            &#34;&#34;&#34;a list of ip to bind socket to and listen to&#34;&#34;&#34;
        else:
            ips = [host]


        self.logger.info(&#34;Creating Socket . . .&#34;)

        self.__sockets : list[socket.socket] = []
        &#34;&#34;&#34;a list of socket to listen to&#34;&#34;&#34;

        for ip in ips:
            self.logger.debug(f&#34;ip : {ip}&#34;)
            soc : socket.socket= socket.socket(socket.AF_INET, socket.SOCK_STREAM)

            self.logger.debug(&#34;....setting socket option&#34;)
            soc.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)

            self.logger.debug(&#34;....trying to bind . . .&#34;)
            try:
                soc.bind((ip,port))
                self.logger.debug(&#34;....socket binding successful.&#34;)
            except OSError as e:
                self.logger.warn(f&#34;Failed to bind @ {ip}:{port}&#34;)
                self.logger.warn(f&#34;Error: {e}&#34;)
                continue

            self.logger.debug(&#34;....trying to listen . . .&#34;)
            try:
                soc.listen()
                self.logger.debug(&#34;....socket start listening . . .&#34;)
            except OSError as e:
                self.logger.warn(f&#34;Failed to listen @ {ip}:{port}&#34;)
                self.logger.warn(f&#34;{e}&#34;)
                continue

            soc.setblocking(False)

            self.logger.info(f&#34;Finished setting up socket @ {ip}:{port}&#34;)
            self.__sockets.append(soc)


        if len(self.__sockets) == 0:
            self.logger.error(&#34;No vaild socket created.&#34;)
            raise SocketException(&#34;No vaild socket created.&#34;)

    def accept(self, stream_logger : Logger | None = None) -&gt; TcpStream:
        &#34;&#34;&#34;
        try accept a new tcp connection.

        ## Parameter:
        `stream_logger : Logger` : logger of returned TcpStream
        
        ## Return:
        `TcpStream` : the accepted tcp connetion

        ## Exception:
        No exception, will continue to try to accept if encounter `OSError`
        &#34;&#34;&#34;
        self.logger.info(&#34;Start accepting . . .&#34;)

        self.logger.debug(&#34;waiting for connection . . .&#34;)
        while True:
            readables, _, _ = select.select(self.__sockets,[],[],1)

            for soc in readables:
                if soc not in self.__sockets:
                    self.logger.debug(&#34;....readables not in self.__sockets&#34;)
                    continue

                (ip,port) = soc.getsockname()

                self.logger.info(f&#34;trying to accept connection at {ip}:{port}&#34;)

                try:
                    accept = soc.accept()
                    conn : socket.socket = accept[0]
                    peer_ip, peer_port = accept[1]
                    self.logger.info(f&#34;Accepting connect successful to {peer_ip}:{peer_port}&#34;)
                except OSError as e:
                    self.logger.warn(&#34;Accepting connection failed&#34;)
                    self.logger.warn(f&#34;{e}&#34;)
                    continue

                stream = TcpStream(conn, stream_logger)
                return stream


    def __del__(self):
        for soc in self.__sockets:
            try:
                (ip,port) = soc.getsockname()
                self.logger.debug(f&#34;shutting down socket @ {ip}:{port}&#34;)
                soc.close()
            except OSError as e:
                self.logger.error(&#34;Failed to shut down socket!&#34;)
                self.logger.error(f&#34;{e}&#34;)
                continue</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="inovopy.socket.tcp_listener.TcpListener.DEFAULT_PORT"><code class="name">var <span class="ident">DEFAULT_PORT</span> : int</code></dt>
<dd>
<div class="desc"><p>Default port to listen on if no poort are specified <code>50003</code>.</p></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="inovopy.socket.tcp_listener.TcpListener.accept"><code class="name flex">
<span>def <span class="ident">accept</span></span>(<span>self, stream_logger: <a title="inovopy.logger.Logger" href="../logger/index.html#inovopy.logger.Logger">Logger</a> | None = None) ‑> <a title="inovopy.socket.tcp_stream.TcpStream" href="tcp_stream.html#inovopy.socket.tcp_stream.TcpStream">TcpStream</a></span>
</code></dt>
<dd>
<div class="desc"><p>try accept a new tcp connection.</p>
<h2 id="parameter">Parameter:</h2>
<p><code>stream_logger : Logger</code> : logger of returned TcpStream</p>
<h2 id="return">Return:</h2>
<p><code>TcpStream</code> : the accepted tcp connetion</p>
<h2 id="exception">Exception:</h2>
<p>No exception, will continue to try to accept if encounter <code>OSError</code></p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def accept(self, stream_logger : Logger | None = None) -&gt; TcpStream:
    &#34;&#34;&#34;
    try accept a new tcp connection.

    ## Parameter:
    `stream_logger : Logger` : logger of returned TcpStream
    
    ## Return:
    `TcpStream` : the accepted tcp connetion

    ## Exception:
    No exception, will continue to try to accept if encounter `OSError`
    &#34;&#34;&#34;
    self.logger.info(&#34;Start accepting . . .&#34;)

    self.logger.debug(&#34;waiting for connection . . .&#34;)
    while True:
        readables, _, _ = select.select(self.__sockets,[],[],1)

        for soc in readables:
            if soc not in self.__sockets:
                self.logger.debug(&#34;....readables not in self.__sockets&#34;)
                continue

            (ip,port) = soc.getsockname()

            self.logger.info(f&#34;trying to accept connection at {ip}:{port}&#34;)

            try:
                accept = soc.accept()
                conn : socket.socket = accept[0]
                peer_ip, peer_port = accept[1]
                self.logger.info(f&#34;Accepting connect successful to {peer_ip}:{peer_port}&#34;)
            except OSError as e:
                self.logger.warn(&#34;Accepting connection failed&#34;)
                self.logger.warn(f&#34;{e}&#34;)
                continue

            stream = TcpStream(conn, stream_logger)
            return stream</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul>
<li><a href="#tcp-listener-module">TCP Listener Module</a><ul>
<li><a href="#classes">Classes</a></li>
</ul>
</li>
</ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="inovopy.socket" href="index.html">inovopy.socket</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="inovopy.socket.tcp_listener.TcpListener" href="#inovopy.socket.tcp_listener.TcpListener">TcpListener</a></code></h4>
<ul class="">
<li><code><a title="inovopy.socket.tcp_listener.TcpListener.DEFAULT_PORT" href="#inovopy.socket.tcp_listener.TcpListener.DEFAULT_PORT">DEFAULT_PORT</a></code></li>
<li><code><a title="inovopy.socket.tcp_listener.TcpListener.accept" href="#inovopy.socket.tcp_listener.TcpListener.accept">accept</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>